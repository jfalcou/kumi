//==================================================================================================
/**
  RABERU - Fancy Parameters Library
  Copyright : RABERU Project Contributors
  SPDX-License-Identifier: BSL-1.0
**/
//==================================================================================================
#define TTS_MAIN
#include "test.hpp"
#include <kumi/kumi.hpp>
#include <string>
#include <tts/tts.hpp>

TTS_CASE("Check result:merge<Tuple...> behavior")
{
  using namespace kumi;
  TTS_TYPE_IS((result::merge_t<tuple<>, tuple<int&, char, float>>), (tuple<int&, char, float>));

  TTS_TYPE_IS((result::merge_t<kumi::tuple<kumi::field<name<"a">, int&>, field<name<"b">, char>>,
                               kumi::tuple<kumi::field<name<"a">, float>>,
                               kumi::tuple<int, float&&, char const&, field<name<"d">, tuple<int>&&>>>),
              (kumi::tuple<field<name<"a">, int&>, field<name<"b">, char>, int, float&&, char const&,
                           field<name<"d">, tuple<int>&&>>));
};

TTS_CASE("Check merge behavior: large defaults, few options")
{
  using namespace std::literals;

  auto defaults = kumi::tuple{coord_ = "Jane Doe"s, value_ = 42.69f, is_modal_};
  ;
  auto opts = kumi::tuple{value_ = 956.7f};
  ;

  auto merged = kumi::merge(opts, defaults);

  TTS_EQUAL(merged[value_], 956.7f);
  TTS_EQUAL(merged[coord_], "Jane Doe"s);
  TTS_EQUAL(merged[is_modal_], true);

  auto nopts = kumi::tuple{"other"_id = 1234};
  ;
  auto merged2 = kumi::merge(nopts, defaults);

  TTS_EQUAL(merged2[value_], 42.69f);
  TTS_EQUAL(merged2["other"_id], 1234);
  TTS_EQUAL(merged2[coord_], "Jane Doe"s);
  TTS_EQUAL(merged2[is_modal_], true);
};

TTS_CASE("Check merge behavior: few defaults, large options")
{
  using namespace std::literals;

  auto opts = kumi::tuple{coord_ = "Jane Doe"s, value_ = 42.69f, is_modal_};
  ;
  auto defaults = kumi::tuple{value_ = 956.7f};
  ;

  auto merged = kumi::merge(opts, defaults);

  TTS_EQUAL(merged[value_], 42.69f);
  TTS_EQUAL(merged[coord_], "Jane Doe"s);
  TTS_EQUAL(merged[is_modal_], true);

  auto ndefaults = kumi::tuple{"other"_id = 1234};
  ;
  auto merged2 = kumi::merge(opts, ndefaults);

  TTS_EQUAL(merged2[value_], 42.69f);
  TTS_EQUAL(merged2["other"_id], 1234);
  TTS_EQUAL(merged2[coord_], "Jane Doe"s);
  TTS_EQUAL(merged2[is_modal_], true);
};
